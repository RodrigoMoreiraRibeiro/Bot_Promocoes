name: Bot Promo√ß√µes KaBuM

on:
  # Execu√ß√£o manual
  workflow_dispatch:
    inputs:
      duration:
        description: 'Tempo para rodar (em horas)'
        required: true
        default: '6'
        type: string
  
  # Execu√ß√£o autom√°tica (opcional)
  schedule:
    - cron: '0 */6 * * *'  # A cada 6 horas

jobs:
  run-promo-bot:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout c√≥digo
      uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Cache dependencies
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-
    
    - name: Instalar depend√™ncias
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Executar bot de promo√ß√µes
      env:
        DISCORD_TOKEN: ${{ secrets.DISCORD_TOKEN }}
        PROMO_CHANNEL_ID: ${{ secrets.PROMO_CHANNEL_ID }}
      run: |
        echo "üöÄ Iniciando bot de promo√ß√µes por ${{ github.event.inputs.duration || '6' }} horas..."
        timeout ${{ github.event.inputs.duration || '6' }}h python bot_promocoes_kabum.py || echo "Bot finalizado ap√≥s timeout"
    
    - name: Upload logs
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: promo-bot-logs
        path: |
          *.log
          logs/
        retention-days: 7
    
    - name: Notificar erro
      if: failure()
      run: |
        echo "‚ùå Bot de promo√ß√µes falhou! Verifique os logs."